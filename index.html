<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>POS System UI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { background: #f8f9fa; }
    .sidebar {
      height: 100vh;
      position: fixed;
      left: 0; top: 0; bottom: 0;
      width: 220px;
      background: #343a40;
      color: #fff;
      padding-top: 60px;
      z-index: 1000;
      transition: left 0.3s;
    }
    .sidebar .nav-link { color: #adb5bd; }
    .sidebar .nav-link.active, .sidebar .nav-link:hover { color: #fff; background: #495057; }
    .sidebar .nav-link i { margin-right: 10px; }
    .main-content { margin-left: 220px; padding: 30px 20px; }
    @media (max-width: 768px) {
      .sidebar { left: -220px; }
      .sidebar.show { left: 0; }
      .main-content { margin-left: 0; }
    }
    .sidebar-toggle {
      position: fixed; left: 10px; top: 10px; z-index: 1100;
      background: #343a40; color: #fff; border: none; border-radius: 4px; padding: 8px 12px;
    }
    .loading-spinner {
      display: flex; align-items: center; justify-content: center; height: 200px;
    }
  </style>
</head>
<body>
<button class="sidebar-toggle d-md-none" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
<div class="sidebar d-flex flex-column p-0" id="sidebarNav">
  <h4 class="text-center mb-4">POS System</h4>
  <nav class="nav flex-column">
    <a class="nav-link active" href="#" onclick="showTab('product')"><i class="fas fa-box"></i> Products</a>
    <a class="nav-link" href="#" onclick="showTab('customers')"><i class="fas fa-users"></i> Customers</a>
    <a class="nav-link" href="#" onclick="showTab('categories')"><i class="fas fa-tags"></i> Categories</a>
    <a class="nav-link" href="#" onclick="showTab('unit')"><i class="fas fa-ruler"></i> Unit</a>
    <a class="nav-link" href="#" onclick="showTab('supplier')"><i class="fas fa-truck"></i> Supplier</a>
    <a class="nav-link" href="#" onclick="showTab('voucherdetails')"><i class="fas fa-file-invoice"></i> Voucher Details</a>
    <a class="nav-link" href="#" onclick="showTab('salelist')"><i class="fas fa-receipt"></i> Sale List</a>
    <a class="nav-link" href="#" onclick="showTab('purchaselist')"><i class="fas fa-shopping-cart"></i> Purchase List</a>
    <a class="nav-link" href="#" onclick="showTab('purchasevoucherdetails')"><i class="fas fa-file-alt"></i> Purchase Voucher Details</a>
    <a class="nav-link" href="#" onclick="showTab('payables')"><i class="fas fa-money-bill-wave"></i> ပေးရန်ရှိသူများ</a>
  </nav>
</div>
<div class="main-content">
  <div id="tab-product" class="tab-pane">
    <h2 class="mb-4">Products</h2>
    <div id="table-product"></div>
  </div>
  <div id="tab-customers" class="tab-pane d-none">
    <h2 class="mb-4">Customers</h2>
    <div id="table-customers"></div>
  </div>
  <div id="tab-categories" class="tab-pane d-none">
    <h2 class="mb-4">Categories</h2>
    <div id="table-categories"></div>
  </div>
  <div id="tab-unit" class="tab-pane d-none">
    <h2 class="mb-4">Unit</h2>
    <div id="table-unit"></div>
  </div>
  <div id="tab-supplier" class="tab-pane d-none">
    <h2 class="mb-4">Supplier</h2>
    <div id="table-supplier"></div>
  </div>
  <div id="tab-voucherdetails" class="tab-pane d-none">
    <h2 class="mb-4">Voucher Details</h2>
    <div id="table-voucherdetails"></div>
  </div>
  <div id="tab-salelist" class="tab-pane d-none">
    <h2 class="mb-4">Sale List</h2>
    <div id="table-salelist"></div>
  </div>
  <div id="tab-purchaselist" class="tab-pane d-none">
    <h2 class="mb-4">Purchase List</h2>
    <div id="table-purchaselist"></div>
  </div>
  <div id="tab-purchasevoucherdetails" class="tab-pane d-none">
    <h2 class="mb-4">Purchase Voucher Details</h2>
    <div id="table-purchasevoucherdetails"></div>
  </div>
  <div id="tab-payables" class="tab-pane d-none">
    <h2 class="mb-4">ပေးရန်ရှိသူများ</h2>
    <div id="payables-summary" class="mb-2"></div>
    <div id="table-payables"></div>
    <nav>
      <ul class="pagination justify-content-center my-2" id="payables-pagination"></ul>
    </nav>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
function toggleSidebar() {
  document.getElementById('sidebarNav').classList.toggle('show');
}
function showTab(tab) {
  document.querySelectorAll('.sidebar .nav-link').forEach(link => link.classList.remove('active'));
  document.querySelectorAll('.sidebar .nav-link').forEach(link => {
    if (link.getAttribute('onclick').includes(tab)) link.classList.add('active');
  });
  document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.add('d-none'));
  document.getElementById('tab-' + tab).classList.remove('d-none');
  if(tab === 'payables') fetchAndRenderPayables();
}
function renderTable(containerId, data) {
  const container = document.getElementById(containerId);
  if (!data || !Array.isArray(data) || data.length === 0) {
    container.innerHTML = '<div class="alert alert-warning">No data found.</div>';
    return;
  }
  const keys = Object.keys(data[0]);
  let html = '<div class="table-responsive"><table class="table table-bordered table-hover table-sm">';
  html += '<thead class="table-dark"><tr>' + keys.map(k => `<th>${k}</th>`).join('') + '</tr></thead>';
  html += '<tbody>';
  data.forEach(row => {
    html += '<tr>' + keys.map(k => `<td>${row[k] ?? ''}</td>`).join('') + '</tr>';
  });
  html += '</tbody></table></div>';
  container.innerHTML = html;
}
function showLoading(containerId) {
  document.getElementById(containerId).innerHTML = '<div class="loading-spinner"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>';
}
const dataFiles = [
  { file: 'product.json', tab: 'product', container: 'table-product' },
  { file: 'customers.json', tab: 'customers', container: 'table-customers' },
  { file: 'categories.json', tab: 'categories', container: 'table-categories' },
  { file: 'unit.json', tab: 'unit', container: 'table-unit' },
  { file: 'supplier.json', tab: 'supplier', container: 'table-supplier' },
  { file: 'voucherdetails.json', tab: 'voucherdetails', container: 'table-voucherdetails' },
  { file: 'salelist.json', tab: 'salelist', container: 'table-salelist' },
  { file: 'purchaselist.json', tab: 'purchaselist', container: 'table-purchaselist' },
  { file: 'purchasevoucherdetails.json', tab: 'purchasevoucherdetails', container: 'table-purchasevoucherdetails' },
];
function fetchAndRenderAll() {
  dataFiles.forEach(({file, container}) => {
    showLoading(container);
    fetch(file)
      .then(res => res.json())
      .then(data => renderTable(container, data))
      .catch(() => {
        document.getElementById(container).innerHTML = '<div class="alert alert-danger">Failed to load '+file+'</div>';
      });
  });
}
function renderPayablesTable(data, page = 1, perPage = 10) {
  const container = document.getElementById('table-payables');
  if (!data || !Array.isArray(data) || data.length === 0) {
    container.innerHTML = '<div class="alert alert-warning">ပေးရန်ရှိသူများ မရှိပါ။</div>';
    document.getElementById('payables-summary').innerHTML = '';
    document.getElementById('payables-pagination').innerHTML = '';
    return;
  }
  const start = (page - 1) * perPage;
  const end = start + perPage;
  const pageData = data.slice(start, end);
  let html = '<div class="table-responsive"><table class="table table-bordered table-hover table-sm">';
  html += '<thead class="table-dark"><tr>' +
    '<th>စဉ်</th>' +
    '<th>ဖောက်သည်အမည်</th>' +
    '<th>ကျန်ငွေ</th>' +
    '<th>နောက်ဆုံးရက်</th>' +
    '<th>ဖုန်းနံပါတ်</th>' +
    '</tr></thead>';
  html += '<tbody>';
  pageData.forEach((row, idx) => {
    html += '<tr>' +
      `<td>${start + idx + 1}</td>` +
      `<td>${row.customername}</td>` +
      `<td>${row.totaldebt.toLocaleString()}</td>` +
      `<td>${row.lastdate}</td>` +
      `<td>${row.phonenumber || '-'}</td>` +
      '</tr>';
  });
  html += '</tbody></table></div>';
  container.innerHTML = html;
  // Summary
  document.getElementById('payables-summary').innerHTML = `စုစုပေါင်း <b>${data.length}</b> ယောက်၊ စာရင်း ${start+1} မှ ${Math.min(end, data.length)}`;
  // Pagination
  renderPayablesPagination(data.length, page, perPage);
}
function renderPayablesPagination(total, current, perPage) {
  const totalPages = Math.ceil(total / perPage);
  const pag = document.getElementById('payables-pagination');
  pag.innerHTML = '';
  if (totalPages <= 1) return;
  const createPage = (p, label, active = false, disabled = false) =>
    `<li class="page-item${active ? ' active' : ''}${disabled ? ' disabled' : ''}">
      <a class="page-link" href="#" onclick="gotoPayablesPage(${p});return false;">${label}</a>
    </li>`;
  pag.innerHTML += createPage(1, 'ပထမ', current === 1, current === 1);
  for (let i = 1; i <= totalPages; i++) {
    if (i === 1 || i === totalPages || (i >= current - 1 && i <= current + 1)) {
      pag.innerHTML += createPage(i, i, current === i);
    } else if (i === current - 2 || i === current + 2) {
      pag.innerHTML += '<li class="page-item disabled"><span class="page-link">...</span></li>';
    }
  }
  pag.innerHTML += createPage(totalPages, 'နောက်ဆုံး', current === totalPages, current === totalPages);
}
let payablesData = [];
let payablesCurrentPage = 1;
function gotoPayablesPage(page) {
  payablesCurrentPage = page;
  renderPayablesTable(payablesData, payablesCurrentPage);
}
function fetchAndRenderPayables() {
  showLoading('table-payables');
  document.getElementById('payables-summary').innerHTML = '';
  document.getElementById('payables-pagination').innerHTML = '';
  Promise.all([
    fetch('voucherdetails.json').then(r => r.json()),
    fetch('customers.json').then(r => r.json())
  ]).then(([vouchers, customers]) => {
    const payables = vouchers.filter(v => v.totalminuspaid > 0 && v.customername);
    const grouped = {};
    payables.forEach(v => {
      if (!grouped[v.customername]) {
        grouped[v.customername] = { 
          customername: v.customername, 
          totaldebt: 0, 
          lastdate: v.date, 
          phonenumber: ''
        };
      }
      grouped[v.customername].totaldebt += v.totalminuspaid;
      if (new Date(v.date.split('/').reverse().join('-')) > new Date(grouped[v.customername].lastdate.split('/').reverse().join('-'))) {
        grouped[v.customername].lastdate = v.date;
      }
    });
    Object.values(grouped).forEach(g => {
      const c = customers.find(cu => cu.name === g.customername);
      if (c) g.phonenumber = c.phonenumber;
    });
    payablesData = Object.values(grouped).sort((a,b) => b.totaldebt - a.totaldebt);
    payablesCurrentPage = 1;
    renderPayablesTable(payablesData, payablesCurrentPage);
  }).catch(() => {
    document.getElementById('table-payables').innerHTML = '<div class="alert alert-danger">ပေးရန်ရှိသူစာရင်း ဖတ်မရပါ။</div>';
  });
}
fetchAndRenderAll();
showTab('product');
</script>
</body>
</html>
